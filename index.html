<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Matemasie&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Import CSS file -->
	<link rel="stylesheet" href="styles.css">
	<!-- Import JavaScript file -->
	<script src="script.js" defer></script>
    <title>AI Assistant</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@400;700&family=Caveat:wght@400..700&display=swap" rel="stylesheet">
	<svg width="0" height="0">
		<defs>
		  <clipPath id="chatBubbleClipPathBot" clipPathUnits="objectBoundingBox">
			<path d="M 0 0 H 1 V 1 H 0.05 V 0.2 Q 0.05 0, 0 0 Z" />
		  </clipPath>
		</defs>
		<defs>
			<clipPath id="chatBubbleClipPathUser" clipPathUnits="objectBoundingBox">
				<path d="M 1 0 H 0 V 1 H 0.95 V 0.2 Q 0.95 0, 1 0 Z" />
			</clipPath>
		  </defs>
	  </svg>
</head>
<body>

  <div id="popupContainer">
    <div id="welcomePopup">
      <h1>Welcome to the Teaching Assistant App!</h1>
      <h2>New User? Enter Username:</h2>
      <input type="text" id="usernameInput" placeholder="Enter your new username here..."><br/>
      
      <h2>Existing User?</h2>
      <input type="text" id="existingUserInput" placeholder="Enter your existing username here...">
      <br/><br/>
      <button id="submitUsernameBtn" onclick="submitUsername()">Submit</button>
    </div>
    <div id="uploadPopup">
      <button id="closePopupBtn" onclick="hideUploadPopup()">X</button>
      <h1>Upload PDF</h1>
      <input type="file" id="pdfInput" accept=".pdf">
      <button id="uploadDocBtn" onclick="onUploadDocument()">Upload</button>
    </div>
  </div>  
  <div id="grid-container">
    <div id="sidebar">
      <span style="font-size: large;">Documents</span>
      <button id="uploadBtn" class="sidebar-button" onclick="showUploadPopup();">+</button>
      
      <div id="sidebar-content">
        <ul id="documentList">
          <!-- Document list will be populated here -->
        </ul>
    </div>
  </div>
	
    <div id="chatContainer">
      <div id="chatTabs">
        <button id="chatTab"  class="tab selected-tab" onclick="switchTabs('chat')">Chat</button>
        <button id="learnTab" class="tab" onclick="switchTabs('learn')">Learn</button>
        <button id="practiceTab" class="tab" onclick="switchTabs('practice')">Practice</button>

      </div>
      <div id="chatMode">
        <div id="chatbox">
          <img align="left" id="mister" src="mister/1.jpg"/>
          <img align="right" id="paladin" src="paladin.png"/>
        </div>
            
        <div style="display: flex; margin-top: 10px;">
              <input type="text" id="userInput" placeholder="Type your prompts here....">
              <button id="sendBtn" type="button" onclick="sendMessage()">Send</button>
          <button id="eraseBtn" onclick="eraseMemory()">Erase Memory</button>
          </div>
        
          <div id="sendingStatus" class="sending-message" style="display: none;">Sending...</div>
        <ul id="urlsList"></ul>
    </div>
    <div id="learnMode">
      <!-- Upload PDF -->
       <h2>Learn Mode</h2>
       
       <div id="flashcardContainer">
        <div id="flashcardDisplay"></div>
        <div id="cardControls">
            <button onclick="previousCard()">Previous</button>
            <button onclick="nextCard()">Next</button>
        </div>
    </div>
    </div>
    <div id="quizContainer"></div>
    <!-- <div id="practiceMode">
      <h2>Practice Mode header</h2>
      <div id="practiceContent">
        <p>Practice mode paragraph.</p>
        <button id="startPracticeBtn" onclick="startPractice()">Start Practice</button>
        <div id="practiceQuestions"></div>
        <div id="practiceAnswers"></div>

        <div class="mcq-question">
          <p>What is 1+1?</p>
          <button onclick="selectMCQ('A')">A. 1</button>
          <button onclick="selectMCQ('B')">B. 2</button>
          <button onclick="selectMCQ('C')">C. 3</button>
          <button onclick="selectMCQ('D')">D. 4</button>
        </div>

        <div class="match-question">
          <p>Match the terms with their definitions:</p>
        <div class="column terms">
          <div class="term" onclick="selectTerm('A')">A</div>
          <div class="term" onclick="selectTerm('B')">B</div>
          <div class="term" onclick="selectTerm('C')">C</div>
        </div>
        <div class="column-definitions">
          <div class="definition" onclick="selectDefinition('A')">A</div>
          <div class="definition" onclick="selectDefinition('B')">B</div>
          <div class="definition" onclick="selectDefinition('C')">C</div>
        </div>
      </div>

        <div class="frq-question">
          <p>FRQ box here.</p>
          <textarea id="frqAnswer"></textarea>
        </div>

        <button id="submitFrqBtn" onclick="submitFrqAnswer()">Submit FRQ Answer</button>
        <div id="frqFeedback"></div>
        <button id="submitAnswersBtn" onclick="submitAnswers()">Submit Answers</button>
        <div id="practiceResults"></div>
      </div> -->
    </div>
    </div>
    </div>
  </div>
</body>
</html>

<script>
  window.flashcards = [
  { question: "a", answer: "b" },
  { question: "c", answer: "d" }
  ];
  window.currentCardIndex = 0;

  window.quiz = [
  {
    type: "mcq",
    question: "What is the capital of France?",
    options: {
      A: "Berlin",
      B: "Paris",
      C: "Rome",
      D: "Madrid"
    },
    correct: "B"
  },
  {
    type: "frq",
    question: "Explain the water cycle.",
    idealAnswer: "..."
  },
  {
    type: "match",
    question: "Match the terms to definitions.",
    pairs: {
      "Evaporation": "Water turning into vapor",
      "Condensation": "Vapor forming clouds",
      "Precipitation": "Rainfall"
    }
  }
];

window.showFlashcard = function(index){
    const display = document.getElementById("flashcardDisplay");
    display.innerHTML = ''; // clear

    // We need to access flashcard text from backend here
    const data = flashcards[index];
    console.log('Rendering flashcard:', data);
    console.log("flashcards length:", flashcards.length);
    console.log("flashcards[0]:", flashcards[0]);

    const card = document.createElement("div");
    card.className = "flashcard";
    card.onclick = () => card.classList.toggle("flipped");

    card.innerHTML = `
        <div class="front">${data.question}</div>
        <div class="back">${data.answer}</div>
    `;

    display.appendChild(card);
}
window.renderQuiz = function(quizData){
  const container = document.getElementById("quizContainer");
  container.innerHTML = ''; // clear previous content

  quizData.forEach((item, index) => {
    let questionElement;

    if (item.type === "mcq") {
      questionElement = document.createElement("div");
      questionElement.className = "question-mcq";
      questionElement.innerHTML = `
        <p>${index + 1}.${item.question}</p>
        <div class="options">
          ${Object.entries(item.options).map(([key, value]) => `
            <button onclick="selectMCQ('${key}')">${key}. ${value}</button>
          `).join('')}
        </div>
      `;
    }

    else if (item.type == "frq"){
      questionElement = document.createElement("div");
      questionElement.className = "question-frq";
      questionElement.innerHTML = `
        <p>${index + 1}.${item.question}</p>
        <textarea onchange="saveFRQ(${index}, this.value)"></textarea>
      `;
    }

    else if (item.type == "match"){
      const terms = Object.keys(item.pairs);
      const definitions = Object.values(item.pairs);

      questionElement = document.createElement("div");
      questionElement.className = "question-match";
      questionElement.innerHTML = `
        <p>${index + 1}.${item.question}</p>
        <div class="match-columns">
          <div class="match-left">
            ${terms.map(term => `<div class="match-term" onclick="selectMatchTerm(${index},'${term}')">${term}</div>`).join('')}
          </div>
          <div class="match-right">
            ${definitions.map(def => `<div class="match-definition" onclick="selectMatchDefinition(${index},'${def}')">${def}</div>`).join('')}
          </div>
      </div>
      `;

      // next steps - handle user answers (global structure)
      // then do per-type response tracking (i.e., saveMCQ, saveFRQ, saveMatch)
      // then send user response to LLM for grading
      // maybe a shuffle fxn for match? low priority
    }

    container.appendChild(questionElement);
  });
}



function nextCard() {
    if (currentCardIndex < flashcards.length - 1) {
        currentCardIndex++;
        showFlashcard(currentCardIndex);
    }
}

function previousCard() {
    if (currentCardIndex > 0) {
        currentCardIndex--;
        showFlashcard(currentCardIndex);
    }
}

// Initialize the first card on load
document.addEventListener("DOMContentLoaded", function () {
    showFlashcard(currentCardIndex);
});
</script>
